---
title: "TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã«å››å‰‡æ¼”ç®—ã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ’»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["typescript", "type-system"]
published: true
---

## ã¯ã˜ã‚ã«

:::message
ä¿®æ­£ã‚„è¿½åŠ ç­‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã¾ãŸã¯GitHubã§ç·¨é›†ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚
:::

ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã€å€‹äººé–‹ç™ºã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰å¼•ç”¨ã—ã¦ã„ã¾ã™ã€‚

https://github.com/riya-amemiya/UMT/blob/main/package/main/src/types/mathType.ts

## ä¸‹æº–å‚™

æ•°å€¤ã‚’ãã®ã¾ã¾æ¼”ç®—ã§ããªã„ã®ã§ã€æ•°å€¤ã‚’é…åˆ—ã«å¤‰æ›ã—ã¦ã‹ã‚‰é…åˆ—ã®é•·ã•ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§æ•°å€¤ã‚’è¡¨ç¾ã—ã¾ã™ã€‚

```ts
// é…åˆ—ã®é•·ã•ã‚’å–å¾—ã™ã‚‹å‹
export type Length<T extends unknown[]> = T extends { length: infer L }
  ? L extends number
    ? L
    : never
  : never;

// æ•°å€¤ã‚’é…åˆ—ã«å¤‰æ›ã™ã‚‹
export type NumToArr<
  T extends number,
  U extends number[] = [],
> = U["length"] extends T ? U : NumToArr<T, [...U, U["length"]]>;
```

## å¼•ãç®—ã‚’å®Ÿè£…ã™ã‚‹

é…åˆ—ã®å·®åˆ†ã‚’å–ã‚‹ã“ã¨ã§å¼•ãç®—ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
è² ã®æ•°ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã«æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦ã‹ã‚‰æ•°å€¤ã«æˆ»ã—ã¾ã™ã€‚

```ts
// å¼•ãç®—
export type Subtract<
  A extends number,
  B extends number,
> = `${A}` extends `-${infer N extends number}`
  ? `${B}` extends `-${infer M extends number}`
    ? Subtract<M, N>
    : `-${Add<N, B>}` extends `${infer R extends number}`
    ? R
    : never
  : `${B}` extends `-${infer M extends number}`
  ? Length<[...NumToArr<A>, ...NumToArr<M>]>
  : NumToArr<A> extends [...NumToArr<B>, ...infer R]
  ? Length<R>
  : NumToArr<B> extends [...NumToArr<A>, ...infer R]
  ? `-${Length<R>}` extends `${infer M extends number}`
    ? M
    : never
  : never;

type SubTest = Subtract<10, 5>; // 5
type SubTest2 = Subtract<5, 10>; // -5
type SubTest3 = Subtract<10, -5>; // 15
type SubTest4 = Subtract<-5, 10>; // -15
type SubTest5 = Subtract<-5, -10>; // 5
```

## è¶³ã—ç®—ã‚’å®Ÿè£…ã™ã‚‹

ãƒã‚¤ãƒŠã‚¹ã®å€¤ã¯å…ˆã»ã©ã®å¼•ãç®—å‹ã«æ¼”ç®—ã‚’ä»»ã›ã¾ã™ã€‚
é…åˆ—ã‚’çµåˆã—ã¦ã‹ã‚‰é•·ã•ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§è¶³ã—ç®—ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```ts
// ãŸã—ç®—
export type Add<
  X extends number,
  Y extends number,
> = `${X}` extends `-${infer N extends number}`
  ? `${Y}` extends `-${infer M extends number}`
    ? `-${Add<N, M>}` extends `${infer R extends number}`
      ? R
      : never
    : Subtract<Y, N>
  : `${Y}` extends `-${infer M extends number}`
  ? Subtract<X, M>
  : Length<[...NumToArr<X>, ...NumToArr<Y>]>;

type AddTest = Add<10, 5>; // 15
type AddTest2 = Add<5, 10>; // 15
type AddTest3 = Add<10, -5>; // 5
type AddTest4 = Add<-5, 10>; // 5
```

## æ›ã‘ç®—ã‚’å®Ÿè£…ã™ã‚‹

è¶³ã—ç®—ã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ã§æ›ã‘ç®—ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
æ›ã‘ç®—ã¯Xã‚’Nå›è¶³ã—ç®—ã™ã‚‹ã¨è§£é‡ˆã§ãã¾ã™ã€‚

```text
1 * 3 = 1 + 1 + 1
```

```ts
// æ›ã‘ç®—
export type Multiply<A extends number, B extends number> = MultiHelper<A, B>;

// æ›ã‘ç®—ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
type MultiHelper<
  X extends number,
  Y extends number,
  A extends number = 0,
> = `${X}` extends `-${infer N extends number}`
  ? `${Y}` extends `-${infer M extends number}`
    ? MultiHelper<N, M, A>
    : `-${MultiHelper<N, Y, A>}` extends `${infer R extends number}`
    ? R
    : never
  : `${Y}` extends `-${infer M extends number}`
  ? `-${MultiHelper<X, M, A>}` extends `${infer R extends number}`
    ? R
    : never
  : Y extends 0
  ? A
  : MultiHelper<X, Subtract<Y, 1>, Add<X, A>>;

type MultiTest = Multiply<10, 5>; // 50
type MultiTest2 = Multiply<5, 10>; // 50
type MultiTest3 = Multiply<10, -5>; // -50
type MultiTest4 = Multiply<-5, 10>; // -50
type MultiTest5 = Multiply<-5, -10>; // 50
```

## å‰²ã‚Šç®—ã‚’å®Ÿè£…ã™ã‚‹

å¼•ãç®—ã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ã§å‰²ã‚Šç®—ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
å‰²ã‚Šç®—ã¯Xã‹ã‚‰Yã‚’å¼•ãç®—ã™ã‚‹ã“ã¨ã‚’ä½•å›ã§ãã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹ã“ã¨ã§å®Ÿè£…ã§ãã¾ã™ã€‚
ã“ã®å‹ã§ã¯ã‚ã¾ã‚Šã‚’åˆ‡ã‚Šæ¨ã¦ã¦ã„ã¾ã™ã€‚

```text
6 / 3 = 6 - 3 - 3
```

```ts
// å‰²ã‚Šç®—
export type Divide<A extends number, B extends number> = A extends 0
  ? never
  : B extends 0
  ? never
  : `${A}` extends `-${infer N extends number}`
  ? `${B}` extends `-${infer M extends number}`
    ? DivideHelper<N, M>
    : `-${DivideHelper<N, B>}` extends `${infer R extends number}`
    ? R
    : never
  : `${B}` extends `-${infer M extends number}`
  ? `-${DivideHelper<A, M>}` extends `${infer R extends number}`
    ? R
    : never
  : DivideHelper<A, B>;

// å‰²ã‚Šç®—ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
type DivideHelper<
  X extends number,
  Y extends number,
  A extends number = 0,
> = BGreaterThanA<X, Y> extends true
  ? A
  : DivideHelper<Subtract<X, Y>, Y, Add<A, 1>>;

type DivideTest = Divide<10, 5>; // 2
type DivideTest2 = Divide<5, 10>; // 0
type DivideTest3 = Divide<10, -5>; // -2
type DivideTest4 = Divide<-5, 10>; // 0
type DivideTest5 = Divide<-5, -10>; // 0
```

## ã‚ã¾ã‚Šã‚’å–å¾—ã™ã‚‹

Xã‹ã‚‰Yã‚’å¼•ãç®—ã™ã‚‹ã“ã¨ã‚’Nå›ç¹°ã‚Šè¿”ã—ã€XãŒYã‚ˆã‚Šå°ã•ããªã£ãŸã‚‰Xã‚’è¿”ã—ã¾ã™ã€‚

```text
6 % 3 = 6 - 3 - 3 = 0
```

```ts
// Xã¨YãŒç­‰ã—ã„ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹å‹
export type Equal<X, Y> = X extends Y ? true : false;

// Aã¾ãŸã¯BãŒ0ã‹ã©ã†ã‹
export type ZeroAorB<A extends number, B extends number> = Equal<
  A,
  0
> extends true
  ? true
  : Equal<B, 0> extends true
  ? true
  : false;

// æ¯”è¼ƒ (A < B)
export type BGreaterThanA<
  A extends number,
  B extends number,
> = `${A}` extends `-${infer N extends number}`
  ? `${B}` extends `-${infer M extends number}`
    ? BGreaterThanA<N, M>
    : BGreaterThanA<N, B>
  : `${B}` extends `-${infer M extends number}`
  ? BGreaterThanA<A, M>
  : ZeroAorB<A, B> extends true
  ? Equal<A, B> extends true
    ? false
    : A extends 0
    ? true
    : false
  : BGreaterThanA<Subtract<A, 1>, Subtract<B, 1>>;


// ä½™ã‚Š
export type Modulo<
  A extends number,
  B extends number,
> = `${A}` extends `-${infer N extends number}`
  ? `${B}` extends `-${infer M extends number}`
    ? Modulo<N, M>
    : Modulo<N, B>
  : `${B}` extends `-${infer M extends number}`
  ? Modulo<A, M>
  : BGreaterThanA<A, B> extends true
  ? A
  : Modulo<Subtract<A, B>, B>;
```

## ã§ããŸå‹ã§éŠã¶

1æ—¥1æ­©ã€3æ—¥ã§3æ­©ã€3æ­©é€²ã‚“ã§2æ­©ä¸‹ãŒã‚‹ã¨Xã«è¾¿ã‚Šç€ãã¾ã§ã«ä½•æ—¥ã‹ã‹ã‚‹ã‹è¨ˆç®—ã—ã¦ã¿ã¾ã™ã€‚
3æ­©é€²ã‚“ã å ´åˆã¯ã€ç¿Œæ—¥2æ­©ä¸‹ãŒã£ã¦ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ãƒ«ãƒ¼ãƒ«ã§ã™ã€‚

```ts
import { Add, Multiply, Subtract } from "./mathType";

export type ThreeStepsForwardTwoStepsBack<T extends number> = T extends 1
  ? 1
  : T extends 2
  ? 2
  : T extends 3
  ? 3
  : Add<3, Multiply<3, Subtract<T, 3>>>;

type Test = ThreeStepsForwardTwoStepsBack<1>; // 1
type Test2 = ThreeStepsForwardTwoStepsBack<2>; // 2
type Test3 = ThreeStepsForwardTwoStepsBack<3>; // 3
type Test4 = ThreeStepsForwardTwoStepsBack<4>; // 6
type Test5 = ThreeStepsForwardTwoStepsBack<5>; // 9
type Test6 = ThreeStepsForwardTwoStepsBack<100>; // 294
```

## ã¾ã¨ã‚

TypeScriptä¸Šã«å››å‰‡æ¼”ç®—ã‚’å®Ÿè£…ã§ãã¾ã—ãŸã€‚
æœ€è¿‘ã‚·ã‚§ãƒ«èŠ¸ãªã‚‰ã¬å‹èŠ¸ã«ãƒãƒã£ã¦ã„ã¾ã™ã€‚
å°æ•°ç‚¹ã‚’æ‰±ãˆãªã„ã®ã§ã€æ‰±ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ãŒæ¬¡ã®èª²é¡Œã§ã™ã€‚
