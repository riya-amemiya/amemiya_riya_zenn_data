---
title: "Vercelã®AI SDKãŒç¥ç¥ã®ç¥"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vercel", "chatgpt", 'gpt3', "openai"]
published: true
---

## ã¯ã˜ã‚ã«

ä¿®æ­£ã‚„è¿½åŠ ç­‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã¾ãŸã¯GitHubã§ç·¨é›†ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚

## æœ¬é¡Œ

é¢ç™½ãã†ãªã®ã§è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚

https://vercel.com/blog/introducing-the-vercel-ai-sdk

## ä½¿ã„æ–¹

apiã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```ts: app/api/route.ts
import { OpenAIStream, StreamingTextResponse } from 'ai'
import { Configuration, OpenAIApi } from 'openai-edge'

// OpenAI APIã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
const config = new Configuration({
  apiKey: process.env.OPENAI_API_KEY
})
const openai = new OpenAIApi(config)

// é‡è¦ï¼runtimeã‚’edgeã«è¨­å®šã—ã¾ã™ã€‚
export const runtime = 'edge'

export async function POST(req: Request) {
  // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æœ¬æ–‡ã‹ã‚‰`messages`ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
  const { messages } = await req.json()
  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æŒ‡å®šã—ã¦OpenAIã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆè£œå®Œã‚’è¦æ±‚ã—ã¾ã™ã€‚
  const response = await openai.createChatCompletion({
    model: 'gpt-3.5-turbo',
    stream: true,
    messages
  })
  // å¿œç­”ã‚’ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ†ã‚­ã‚¹ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å¤‰æ›ã—ã¾ã™ã€‚
  const stream = OpenAIStream(response)
  // ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§å¿œç­”ã—ã¾ã™ã€‚
  return new StreamingTextResponse(stream)
}
```

Pageã‚’ä½œæˆã—ã¾ã™ã€‚

```tsx: app/pages/chat.tsx
'use client'

import { useChat } from 'ai/react'

export default function Chat() {
  const { messages, input, handleInputChange, handleSubmit } = useChat()
  // useChat({ api: `/api/chat` }) ã¨ã™ã‚‹ã¨ã€URLã‚’æŒ‡å®šã§ãã¾ã™ã€‚

  return (
    <div>
      {messages.map(m => (
        <div key={m.id}>
          {m.role}: {m.content}
        </div>
      ))}

      <form onSubmit={handleSubmit}>
        <label>
          Say something...
          <input
            value={input}
            onChange={handleInputChange}
          />
        </label>
      </form>
    </div>
  )
}
```

ãŸã£ãŸã“ã‚Œã ã‘ã§å‹•ãã¾ã™ã€‚
ã—ã‹ã‚‚ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ ã§å‹•ã„ã¦ã„ã‚‹ã®ã§ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«å¿œç­”ãŒè¿”ã£ã¦ãã¾ã™ã€‚

## ã¡ã‚‡ã£ã¨æ”¹è‰¯ã™ã‚‹

ãƒ¢ãƒ‡ãƒ«ã®ç¨®é¡ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™ã€‚

```ts: app/api/[model]/route.ts
import { OpenAIStream, StreamingTextResponse } from 'ai'
import { Configuration, OpenAIApi } from 'openai-edge'

// OpenAI APIã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
const config = new Configuration({
  apiKey: process.env.OPENAI_API_KEY
})
const openai = new OpenAIApi(config)

// é‡è¦ï¼runtimeã‚’edgeã«è¨­å®šã—ã¾ã™ã€‚
export const runtime = 'edge'

export async function POST(
  req: Request,
  { params }: { params: { model: string } },
) {
  const model = params.model;
  // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æœ¬æ–‡ã‹ã‚‰`messages`ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
  const { messages } = await req.json()
  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æŒ‡å®šã—ã¦OpenAIã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆè£œå®Œã‚’è¦æ±‚ã—ã¾ã™ã€‚
  const response = await openai.createChatCompletion({
    model: 'gpt-3.5-turbo',
    stream: true,
    messages
  })
  // å¿œç­”ã‚’ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ†ã‚­ã‚¹ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å¤‰æ›ã—ã¾ã™ã€‚
  const stream = OpenAIStream(response)
  // ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§å¿œç­”ã—ã¾ã™ã€‚
  return new StreamingTextResponse(stream)
}
```

```tsx: app/pages/chat.tsx
'use client'

import { useChat } from 'ai/react'
import { useState } from "react";
export default function Chat() {
  const [model, setModel] = useState("gpt-3.5-turbo-16k");
  const { messages, input, handleInputChange, handleSubmit } = useChat({
    api: `/api/chat/${model}`,
  });

  return (
    <div>
      {messages.map(m => (
        <div key={m.id}>
          {m.role}: {m.content}
        </div>
      ))}
      <select onChange={(e) => setModel(e.target.value)}>
        <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
        <option value="gpt-3.5-turbo-16k">gpt-3.5-turbo-16k</option>
        <option value="gpt-4">gpt-4</option>
      </select>
      <form onSubmit={handleSubmit}>
        <label>
          Say something...
          <input
            value={input}
            onChange={handleInputChange}
          />
        </label>
      </form>
      <sele
    </div>
  )
}
```

## å…¬å¼ã®ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰

https://sdk.vercel.ai/

## ã¾ã¨ã‚

ãƒã‚¸ã§ç¥ã§ã™ã€‚
ä¾¿åˆ©ã™ãã¦ã€ã‚‚ã†ã“ã‚Œã§ã„ã„ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã£ã¦ã—ã¾ã†ã»ã©ã§ã™ã€‚
çˆ†é€Ÿã§é–‹ç™ºã§ãã‚‹åé¢ã€Next.jsã«ä¾å­˜ã—ã¦ã—ã¾ã†ã®ãŒå°‘ã—æ€–ã„ã§ã™ã€‚
