---
title: 'Nextã‹ã‚‰GraphQLã®APIã‚’å©ã'
emoji: 'ğŸ¡'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['nextjs', 'graphql']
published: true
---

## ã¯ã˜ã‚ã«

ä¿®æ­£ã‚„è¿½åŠ ç­‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã¾ãŸã¯GitHubã§ç·¨é›†ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚

ã“ã®è¨˜äº‹ã¯å‰å›ã®è¨˜äº‹ã®ç¶šãã§ã™ã€‚

https://zenn.dev/riya_amemiya/articles/d8681e57ae5428

## Next ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```bash
npx create-next-app [project-name] --typescript
```

## GraphQL ã®å°å…¥

```bash
yarn add graphql-request graphql
```

## SWR ã®å°å…¥

```bash
yarn add swr
```

## GraphQL ã® API ã‚’å©ã

### èªè¨¼ãªã—

```ts:pages/api/graphql.ts
import { GraphQLClient } from 'graphql-request';
import { NextApiRequest, NextApiResponse } from 'next';
export default async function handler(
    req: NextApiRequest,
    res: NextApiResponse,
) {
    const endpoint =
        process.env.NODE_ENV === 'production'
            ? 'https://.../graphql'
            : 'http://localhost:3001/graphql';
    const graphQLClient = new GraphQLClient(endpoint);
    const data = await graphQLClient.request(
        JSON.parse(req.body).query,
    );
    res.status(200).json({ data });
}
```

#### Authorizationèªè¨¼ã‚’ã™ã‚‹å ´åˆ

```ts:pages/api/graphql.ts
import { GraphQLClient } from 'graphql-request';
import { NextApiRequest, NextApiResponse } from 'next';
export default async function handler(
    req: NextApiRequest,
    res: NextApiResponse,
) {
    const endpoint =
        process.env.NODE_ENV === 'production'
            ? 'https://.../graphql'
            : 'http://localhost:3001/graphql';
    const graphQLClient = new GraphQLClient(endpoint, {
        headers: {
            authorization: process.env.AUTH_KEY || '',
        },
    });
    const data = await graphQLClient.request(
        JSON.parse(req.body).query,
    );
    res.status(200).json({ data });
}
```

### ãƒ•ãƒ­ãƒ³ãƒˆ

```tsx
import useSWRMutation from 'swr/mutation';
const fetcher = (url: string, { arg }: { arg: any }) =>
    fetch(url, {
        method: 'POST',
        body: JSON.stringify(arg),
    }).then((r) => r.json());
const { trigger } = useSWRMutation('api/graphql', fetcher);
trigger({
    query: `
   {
    getAllUser {
     email
     gender
     id
     name
    }
   }
   `,
    variables: {},
});
```

é©å½“ãªå ´æ‰€ã«ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¨ã€GraphQLã®APIã‚’å©ãã“ã¨ãŒã§ãã¾ã™ã€‚
