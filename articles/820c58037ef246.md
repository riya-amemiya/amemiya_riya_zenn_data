---
title: "TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ä¸Šã«2é€²æ•°è¨ˆç®—æ©Ÿã‚’ä½œã£ãŸè©±ã—"
emoji: "ğŸ‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["typescript","2é€²æ•°"]
published: true
---

## ã¯ã˜ã‚ã«

:::message
ä¿®æ­£ã‚„è¿½åŠ ç­‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã¾ãŸã¯GitHubã§ç·¨é›†ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚
:::

ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã€å€‹äººé–‹ç™ºã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰æŠœç²‹ã—ãŸã‚‚ã®ã§ã™ã€‚

https://github.com/riya-amemiya/UMT/blob/main/package/main/src/types/logicType.ts

## 2é€²æ•°ã®è¨ˆç®—æ–¹æ³•

ï¼’ã¤ã®å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€ç­”ãˆã¨ç¹°ã‚Šä¸ŠãŒã‚Šã‚’å‡ºåŠ›ã™ã‚‹å‹ã‚’ä½œã‚Šã¾ã™ã€‚

```typescript
// 1bitã®2é€²æ•°ã®ANDã‚’æ±‚ã‚ã‚‹å‹
export type binary1bitAND<
  X extends `${0 | 1}`,
  Y extends `${0 | 1}`,
> = binary1bitANDParser<X, Y>;

type binary1bitANDParser<X extends string, Y extends string> = X extends "1"
  ? Y extends "1"
    ? "1"
    : "0"
  : "0";

// 1bitã®2é€²æ•°ã®XORã‚’æ±‚ã‚ã‚‹å‹
export type binary1bitXOR<
  X extends `${0 | 1}`,
  Y extends `${0 | 1}`,
> = binary1bitXORParser<X, Y>;

type binary1bitXORParser<X extends string, Y extends string> = X extends "1"
  ? Y extends "1"
    ? "0"
    : "1"
  : Y extends "1"
  ? "1"
  : "0";

// åŠåŠ ç®—å™¨
export type binaryHalfAdder<
  X extends `${0 | 1}`,
  Y extends `${0 | 1}`,
> = binaryHalfAdderParser<X, Y>;

type binaryHalfAdderParser<
  X extends string,
  Y extends string,
  C extends string = "",
> = C extends ""
  ? binaryHalfAdderParser<X, Y, binary1bitANDParser<X, Y>>
  : `${C}${binary1bitXORParser<X, Y>}`;
```

ã“ã‚Œã‚’åŠåŠ ç®—å™¨ã¨è¨€ã„ã¾ã™ã€‚
`{ç¹°ã‚Šä¸Šã’}{ç­”ãˆ}` ã®å½¢å¼ã§å‡ºåŠ›ã—ã¾ã™ã€‚

![](/images/820c58037ef246/harf.png)

```typescript
type Test = binaryHalfAdder<"1", "1">; // "10"
```

1æ¡ã®è¨ˆç®—ã—ã‹ã§ããªã„ã®ã§ã€åŠåŠ ç®—å™¨ã‚’çµ„ã¿åˆã‚ã›ã¦å…¨åŠ ç®—å™¨ã‚’ä½œã‚Šã¾ã™ã€‚
å…¨åŠ ç®—å™¨ã¯ã€2å€‹ã®åŠåŠ ç®—å™¨ã¨1å€‹ã®ORã‹ã‚‰æ§‹æˆã‹ã‚‰æ§‹æˆã•ã‚Œã€ä»»æ„ã®æ¡æ•°ã®2é€²æ•°ã®åŠ ç®—ãŒã§ãã¾ã™ã€‚

## å…¨åŠ ç®—å™¨

```typescript
// 1bitã®2é€²æ•°ã®ORã‚’æ±‚ã‚ã‚‹å‹
export type binary1bitOR<
  X extends `${0 | 1}`,
  Y extends `${0 | 1}`,
> = binary1bitORParser<X, Y>;

type binary1bitORParser<X extends string, Y extends string> = X extends "1"
  ? "1"
  : Y extends "1"
  ? "1"
  : "0";

// æ–‡å­—åˆ—ã®å…ˆé ­ã‹ã‚‰Næ–‡å­—ã‚’å–å¾—ã™ã‚‹å‹
export type FirstNChars<
  S extends string,
  N extends number,
  C extends unknown[] = [],
  A extends string = "",
> = C["length"] extends N
  ? A
  : S extends `${infer Head}${infer Rest}`
  ? FirstNChars<Rest, N, [...C, Head], `${A}${Head}`>
  : never;

// æ–‡å­—åˆ—ã®å…ˆé ­ã‚’å‰Šé™¤ã™ã‚‹å‹
export type ShiftString<S extends string> = S extends `${string}${infer R}`
  ? R
  : never;

// æ–‡å­—åˆ—ã‚’é…åˆ—ã«å¤‰æ›ã™ã‚‹å‹
export type StringToArray<
  S extends string,
  T extends unknown[] = [],
> = S extends `${infer F}${infer R}` ? StringToArray<R, [...T, F]> : T;

// æ–‡å­—ã‚’é…åˆ—ã«å¤‰æ›ã—ã¦é•·ã•ã‚’å–å¾—ã™ã‚‹å‹
export type LengthOfString<S extends string,> = StringToArray<S>["length"];

// æ–‡å­—åˆ—ã‚’åè»¢ã™ã‚‹å‹
export type StringReverse<S extends string> = S extends `${infer F}${infer R}`
  ? `${StringReverse<R>}${F}`
  : "";

// å…¨åŠ ç®—å™¨
export type binaryFullAdder<
  X extends string,
  Y extends string,
  B extends number = LengthOfString<X>,
> = LengthOfString<X> extends LengthOfString<Y>
  ? FirstNChars<
      ShiftString<
        StringReverse<
          binaryFullAdderParser<
            StringReverse<FirstNChars<X, B>>,
            StringReverse<FirstNChars<Y, B>>
          >
        >
      >,
      B
    >
  : never;

type binaryFullAdderParser<
  X extends string,
  Y extends string,
  A extends string = "",
  C extends string = "0",
> = X extends `${infer F}${infer R}`
  ? Y extends `${infer F2}${infer R2}`
    ? binaryHalfAdderParser<F, F2> extends `${infer F3}${infer R3}`
      ? binaryHalfAdderParser<R3, C> extends `${infer F4}${infer R4}`
        ? binaryFullAdderParser<R, R2, `${A}${R4}`, binary1bitORParser<F3, F4>>
        : never
      : never
    : never
  : `${A}${C}`;
```

TypeScriptã®ä»•æ§˜ã®é–¢ä¿‚ã§ã€å…ˆé ­ã‹ã‚‰æ–‡å­—åˆ—ã‚’å–ã‚Šå‡ºã—ã¦ã€è¨ˆç®—ã—ã¾ã™ã€‚
æ–‡å­—åˆ—ã‚’åè»¢ã•ã›ã¦ã€è¨ˆç®—ã—ãŸå¾Œã«ã€å†åº¦åè»¢ã•ã›ã¦ã€å…ƒã®æ–‡å­—åˆ—ã«æˆ»ã—ã¾ã™ã€‚
ä»Šå›ã¯ç¬¦å·ä»˜ãã®2é€²æ•°ã‚’æ‰±ã†ã®ã§ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã¯åˆ‡ã‚Šæ¨ã¦ã¾ã™ã€‚

![](/images/820c58037ef246/full.png)

```typescript
type Test = binaryFullAdder<"00001000", "00001110">; // "00010110" 22
type Test2 = binaryFullAdder<"00001000", "00001111">; // "00010111" 23
type Test3 = binaryFullAdder<"11111111", "00001000">; // "00000111" 7
```

:::detailsã‚³ãƒ¼ãƒ‰å…¨æ–‡

```typescript
// 1bitã®2é€²æ•°ã®ANDã‚’æ±‚ã‚ã‚‹å‹
export type binary1bitAND<
  X extends `${0 | 1}`,
  Y extends `${0 | 1}`,
> = binary1bitANDParser<X, Y>;

type binary1bitANDParser<X extends string, Y extends string> = X extends "1"
  ? Y extends "1"
    ? "1"
    : "0"
  : "0";

// 1bitã®2é€²æ•°ã®XORã‚’æ±‚ã‚ã‚‹å‹
export type binary1bitXOR<
  X extends `${0 | 1}`,
  Y extends `${0 | 1}`,
> = binary1bitXORParser<X, Y>;

type binary1bitXORParser<X extends string, Y extends string> = X extends "1"
  ? Y extends "1"
    ? "0"
    : "1"
  : Y extends "1"
  ? "1"
  : "0";

// åŠåŠ ç®—å™¨
export type binaryHalfAdder<
  X extends `${0 | 1}`,
  Y extends `${0 | 1}`,
> = binaryHalfAdderParser<X, Y>;

type binaryHalfAdderParser<
  X extends string,
  Y extends string,
  C extends string = "",
> = C extends ""
  ? binaryHalfAdderParser<X, Y, binary1bitANDParser<X, Y>>
  : `${C}${binary1bitXORParser<X, Y>}`;

// 1bitã®2é€²æ•°ã®ORã‚’æ±‚ã‚ã‚‹å‹
export type binary1bitOR<
  X extends `${0 | 1}`,
  Y extends `${0 | 1}`,
> = binary1bitORParser<X, Y>;

type binary1bitORParser<X extends string, Y extends string> = X extends "1"
  ? "1"
  : Y extends "1"
  ? "1"
  : "0";

// æ–‡å­—åˆ—ã®å…ˆé ­ã‹ã‚‰Næ–‡å­—ã‚’å–å¾—ã™ã‚‹å‹
export type FirstNChars<
  S extends string,
  N extends number,
  C extends unknown[] = [],
  A extends string = "",
> = C["length"] extends N
  ? A
  : S extends `${infer Head}${infer Rest}`
  ? FirstNChars<Rest, N, [...C, Head], `${A}${Head}`>
  : never;

// æ–‡å­—åˆ—ã®å…ˆé ­ã‚’å‰Šé™¤ã™ã‚‹å‹
export type ShiftString<S extends string> = S extends `${string}${infer R}`
  ? R
  : never;

// æ–‡å­—åˆ—ã‚’é…åˆ—ã«å¤‰æ›ã™ã‚‹å‹
export type StringToArray<
  S extends string,
  T extends unknown[] = [],
> = S extends `${infer F}${infer R}` ? StringToArray<R, [...T, F]> : T;

// æ–‡å­—ã‚’é…åˆ—ã«å¤‰æ›ã—ã¦é•·ã•ã‚’å–å¾—ã™ã‚‹å‹
export type LengthOfString<S extends string,> = StringToArray<S>["length"];

// æ–‡å­—åˆ—ã‚’åè»¢ã™ã‚‹å‹
export type StringReverse<S extends string> = S extends `${infer F}${infer R}`
  ? `${StringReverse<R>}${F}`
  : "";

// å…¨åŠ ç®—å™¨
export type binaryFullAdder<
  X extends string,
  Y extends string,
  B extends number = LengthOfString<X>,
> = LengthOfString<X> extends LengthOfString<Y>
  ? FirstNChars<
      ShiftString<
        StringReverse<
          binaryFullAdderParser<
            StringReverse<FirstNChars<X, B>>,
            StringReverse<FirstNChars<Y, B>>
          >
        >
      >,
      B
    >
  : never;

type binaryFullAdderParser<
  X extends string,
  Y extends string,
  A extends string = "",
  C extends string = "0",
> = X extends `${infer F}${infer R}`
  ? Y extends `${infer F2}${infer R2}`
    ? binaryHalfAdderParser<F, F2> extends `${infer F3}${infer R3}`
      ? binaryHalfAdderParser<R3, C> extends `${infer F4}${infer R4}`
        ? binaryFullAdderParser<R, R2, `${A}${R4}`, binary1bitORParser<F3, F4>>
        : never
      : never
    : never
  : `${A}${C}`;

```

:::

## ã¾ã¨ã‚

TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã£ã¦ã€2é€²æ•°ã®è¨ˆç®—æ©Ÿã‚’ä½œã‚Šã¾ã—ãŸã€‚
TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒãƒ¥ãƒ¼ãƒªãƒ³ã‚°å®Œå…¨ãªã®ã§ã€ã§ãã‚‹ã“ã¨ã¯ç„¡é™ã«ã‚ã‚Šã¾ã™ã€‚
æ¬¡å›ã¯ã€ä¹—ç®—ã€é™¤ç®—ã‚’å®Ÿè£…ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚
